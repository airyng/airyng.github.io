/*! For license information please see bundle.2b7ac56c29fde79486dd.js.LICENSE.txt */
(()=>{"use strict";var t,e,i,s,a={622:(t,e,i)=>{i.a(t,(async(t,s)=>{try{i.d(e,{a:()=>l});var a=i(343),n=i(95),h=i(20),r=i(157),o=t([n]);n=(o.then?(await o)():o)[0];const c=3;class l extends a.a{_loveLevel=0;constructor(t){super(t);const e=this;!(async function(){const t=await(0,r.b)(n.b,176,32,7,6),i=(e=0,i=-10)=>new h.f({image:t,x:e,y:i,opacity:0,anchor:{x:.5,y:0}});e.addChild(i(t.width/2-5),i(t.width/2-(t.width+1)-5),i(t.width/2-(t.width+1)/2-5,-17))})()}increaseLoveLevel(t=1){this._loveLevel+=t,this._loveLevel>c&&(this._loveLevel=c);for(let t=1;t<=this._loveLevel;t++)this.children[t-1].opacity=1}onFlipped(){this.children.forEach((t=>{t.scaleX*=-1}))}}s()}catch(t){s(t)}}))},343:(t,e,i)=>{i.d(e,{a:()=>a});var s=i(20);class a extends s.d{_maxSpeed=3;_speed=0;_targetX=null;_startX=null;_initialScale=1;_adrenalineMode=!1;_adrenalineTimeLimit=!1;_viewLength=300;_flipInterval=null;constructor(t){const e=(t.scale||1)*(Math.random()>.5?1:-1),i={};t.image&&(i.image=t.image),t.animations&&(i.animations=t.animations),super({x:t.x,y:t.y,anchor:{x:.5,y:0},scaleX:e,scaleY:t.scale||1,...i}),this._viewLength=t.viewLength||300,this._startX=t.x,this._initialScale=e,this._speed=this._maxSpeed,this._flipInterval=setInterval((()=>{this.targetX||(this.scaleX*=-1,this.onFlipped?.())}),1e3*(0,s.j)(5,10))}clearCycle(){clearInterval(this._flipInterval)}setTargetX(t){this._targetX=t}stopMoving(){this._targetX=null,this.dx=0,this.animations?.idle&&this.playAnimation("idle")}moveTo(t){const e=t>this.x?1:-1;this.dx=e*this._speed,this.scaleX=Math.abs(this._initialScale)*e,this.animations?.walk&&this.playAnimation("walk"),this.isAdrenalined()&&this.animations?.run&&this.playAnimation("run")}activateAdrenaline(t=1){this._adrenalineMode=!0,this._speed=2.1*this._maxSpeed,this._adrenalineTimeLimit=1e3*t+Date.now()}deactivateAdrenaline(){this._adrenalineMode=!1,this._speed=this._maxSpeed,this._adrenalineTimeLimit=0}isAdrenalined(){return!!this._adrenalineMode}checkIsPointInView(t){const e=this.scaleX>0?1:-1,i=Math.min(this.x,this.x+this._viewLength*e),s=Math.max(this.x,this.x+this._viewLength*e);return t>=i&&t<=s}update(){this._adrenalineMode&&this._adrenalineTimeLimit<=Date.now()&&this.deactivateAdrenaline(),null!==this._targetX&&Math.abs(this.x-this._targetX)<=this.dx&&(this._targetX===this._startX?this.stopMoving():this.setTargetX(this._startX)),null!==this._targetX&&this.moveTo(this._targetX),super.update()}}},378:(t,e,i)=>{i.d(e,{a:()=>a});var s=i(20);class a extends s.d{_moveDirection=0;_maxSpeed=3;_speed=0;_initialScale=1;_adrenalineMode=!1;_adrenalineTimeLimit=!1;_winking=!1;_lastWinkingTime=0;_winkingCooldown=1.5;constructor(t){const e=t.scale||1,i={};if(t.image&&(i.image=t.image),t.animations&&(i.animations=t.animations),super({x:t.x,y:t.y,anchor:{x:.5,y:0},scaleX:e,scaleY:e,...i}),this._initialScale=e,this._speed=this._maxSpeed,t.extraAnimations?.winking){const e=new s.d({x:-2,y:3,animations:t.extraAnimations.winking});e.opacity=0,this.addChild(e)}}update(t,e){this._adrenalineMode&&this._adrenalineTimeLimit<=Date.now()&&this.deactivateAdrenaline(),this.calculateMovement(t,e),super.update()}setMoveDirection(t){this._moveDirection!==t&&(0===t?this.animations?.idle&&this.playAnimation("idle"):(this.animations?.walk&&this.playAnimation("walk"),this.isAdrenalined()&&this.animations?.run&&this.playAnimation("run")),this._moveDirection=t)}setWinking(t){if(t||(this._winking=t),!t||!this.children[0]?.animations?.wink||Date.now()<=this._lastWinkingTime+1e3*this._winkingCooldown)return;this._winking=t,this.children[0].opacity=1,this.children[0].playAnimation("wink");const e=this.children[0].animations.wink.frames.length/this.children[0].animations.wink.frameRate;setTimeout((()=>{this.children[0].opacity=0}),1e3*e),this._lastWinkingTime=Date.now()}isWinking(){return!!this._winking}activateAdrenaline(t=1){this._adrenalineMode=!0,this._speed=2*this._maxSpeed,this._adrenalineTimeLimit=1e3*t+Date.now(),0!==this.dx&&this.animations?.run&&this.playAnimation("run")}deactivateAdrenaline(){this._adrenalineMode=!1,this._speed=this._maxSpeed,this._adrenalineTimeLimit=0,0!==this.dx&&this.animations?.walk&&this.playAnimation("walk")}isAdrenalined(){return!!this._adrenalineMode}calculateMovement(t,e={left:150,right:150}){0!==this._moveDirection&&(this.scaleX=this._moveDirection<0?-this._initialScale:this._initialScale),this.dx=this._moveDirection*this._speed;const i=this.x-this.width*this.anchor.x;return this.dx<0&&i-(t.camera.x-t.camera.width/2)<=e.left?(t.camera.x<=t.camera.width/2&&(this.dx=0),void(t.camera.x+=this.dx)):this.dx>0&&i-(t.camera.x-t.camera.width/2)>=t.camera.width-e.right-this.width?(t.camera.x+t.camera.width/2>=t.width&&(this.dx=0),void(t.camera.x+=this.dx)):void 0}}},647:(t,e,i)=>{i.a(t,(async(t,s)=>{try{i.d(e,{a:()=>c});var a=i(343),n=i(20),h=i(157),r=i(95),o=t([r]);r=(o.then?(await o)():o)[0];class c extends a.a{_loveLevel=0;constructor(t){super(t);const e=this;!(async function(){const t=await(0,h.b)(r.b,183,32,7,3),i=new n.f({image:t,x:-3,y:6,opacity:0});e.addChild(i)})()}activateAdrenaline(t){super.activateAdrenaline(t),this.children[0].opacity=1}deactivateAdrenaline(){super.deactivateAdrenaline(),this.children[0].opacity=0}}s()}catch(t){s(t)}}))},239:(t,e,i)=>{i.d(e,{a:()=>n,b:()=>a});var s=i(20);const a=(t={})=>{const e=(0,s.g)();e.font=`${t.fontSize||24}px cursive, Arial`,e.textAlign="center",e.fillStyle=t.color||"white",e.fillText(t.text||"-",t.x,t.y)},n=(t={})=>{let e=(0,s.b)({maxSize:t.maxSize||1,create:s.f});return{pool:e,update:()=>{e.get(t.get()),e.update()},destroy:()=>{e.objects.forEach((t=>{t.opacity=0,t.ttl=0})),e.clear()}}}},157:(t,e,i)=>{i.d(e,{a:()=>r,b:()=>a,c:()=>n,d:()=>h});var s=i(20);const a=(t,e,i,s,a)=>new Promise((n=>{const h=document.createElement("canvas"),r=h.getContext("2d"),o=document.createElement("img");h.width=s,h.height=a,r.drawImage(t,e,i,s,a,0,0,s,a),o.src=h.toDataURL("image/png"),n(o)})),n=(t,e={x:0,y:0},i={x:0,y:0},s=1,a="grey")=>{const n=t.context;n.beginPath(),n.strokeStyle=a,n.lineWidth=s,n.moveTo(e.x,e.y),n.lineTo(i.x,i.y),n.stroke()},h=(t,e)=>{const i=t.width,s=t.height,a=e.clientWidth,n=e.clientHeight;let h=a/i;a>n&&s*h>n&&(h=n/s),n>a&&i*h>a&&(h=a/i),t.style.width=i*h+"px",t.style.height=s*h+"px"},r=(t,e,i={x:0,y:0},a={x:0,y:0})=>{const h=new Array(t).fill(null).map((()=>({x:(0,s.j)(i.x,a.x),y:(0,s.j)(i.y,a.y),visible:!0}))),r=setInterval((()=>{const t=h.find((t=>!t.visible));t&&(t.visible=!0),h[(0,s.j)(0,h.length-1)].visible=!1}),500);return{stars:h,render(){h.forEach((t=>{t.visible&&n(e,{x:t.x,y:t.y},{x:t.x+1,y:t.y+1})}))},destroy(){clearInterval(r)}}}},943:(t,e,i)=>{i.d(e,{a:()=>s});const s={handlers:{},pressedButtons:[],init(){document.onkeydown=t=>{t.repeat||(this.pressedButtons.push(t.code),this.handlers[t.code]?.down?.())},document.onkeyup=t=>{this.pressedButtons=this.pressedButtons.filter((e=>e!==t.code)),this.handlers[t.code]?.up?.()}},on(t,e,i){this.handlers[t]={down:e,up:i}},off(t){delete this.handlers[t]},isPressed(t){return this.pressedButtons.findIndex((e=>e===t))>-1},getMaxPriorityPressedButton(t=[]){const e=t.map((t=>this.pressedButtons.findIndex((e=>e===t)))).reduce(((t,e)=>Math.max(t,e)),-1);return this.pressedButtons[e]}}},138:(t,e,i)=>{i.a(t,(async(t,e)=>{try{var s=i(20),a=i(95),n=i(157),h=t([a]);a=(h.then?(await h)():h)[0];const r=1200,o=800,{canvas:c}=(0,s.h)();c.width=r,c.height=o,(0,s.g)().imageSmoothingEnabled=!1,["load","resize"].forEach((t=>window.addEventListener(t,(()=>(0,n.d)(c,document.querySelector("body"))))));const l={width:r,height:o,mainSS:a.b,spriteSheets:a.a,sceneSetupsList:{start:(await Promise.resolve().then(i.bind(i,282))).default,game:(await Promise.resolve().then(i.bind(i,206))).default}},d=async(t,e)=>{t?.beforeDestroy?.(),t?.destroy?.();const{loop:i}=await e(l,d);i.start()};d(null,l.sceneSetupsList.start),e()}catch(t){e(t)}}),1)},206:(t,e,i)=>{i.a(t,(async(t,s)=>{try{i.r(e),i.d(e,{default:()=>w});var a=i(20),n=i(378),h=i(622),r=i(647),o=i(943),c=i(239),l=i(157),d=t([h,r]);[h,r]=d.then?(await d)():d;const p=4,m=3,u="#b20116";async function w(t,e){const i=t.mainSS,s=await(0,l.b)(i,0,0,256,32),d=await(0,l.b)(i,256,0,29,36),w=await(0,l.b)(i,285,0,8,52),x=await(0,l.b)(i,156,32,10,13),y=await(0,l.b)(i,166,32,10,8),f=await(0,l.b)(i,190,32,40,19),_=await(0,l.b)(i,230,32,26,18),g=t.width/2,v=t.height/2;let b=0,S=!1;const A=[116,460,814,1230,1580,2e3,2350,2762,3120,3372].map((t=>new a.f({x:t,y:120,scaleX:m,scaleY:m,image:d}))),k=new Array(4).fill(null).map(((t,e)=>new a.f({x:e*s.width*m,y:480,scaleX:m,scaleY:m,image:s}))),M=[y,x].map(((t,e)=>new Array(120).fill(null).map(((i,s)=>new a.f({x:s*t.width*m,y:e?682:630,scaleX:m,scaleY:m,image:t}))))).flat(),X=new Array(130).fill(null).map(((t,e)=>new a.f({x:e*w.width*m,y:207,scaleX:m,scaleY:m,image:w}))),E=new Array(110).fill(null).map(((t,e)=>new a.f({x:e*f.width*m,y:387,scaleX:m,scaleY:m,image:f}))),L=new Array(110).fill(null).map(((t,e)=>new a.f({x:e*_.width*m,y:576,scaleX:m,scaleY:m,image:_}))),j=new a.f({x:0,y:110,color:"#8d8688",width:3072,height:97}),T=new a.f({x:0,y:234,color:u,width:3500,height:325}),z=new a.f({x:0,y:652,color:u,width:3500,height:30}),D=s.width*k.length*m,P=new n.a({x:300,y:t.height-250+6,animations:t.spriteSheets.playerSpritesheet.animations,scale:m,extraAnimations:{winking:t.spriteSheets.winkingSpritesheet.animations}}),Y=Array(1).fill(null).map(((e,i)=>new h.a({x:390*(i+1),y:t.height-250,animations:t.spriteSheets.men1Spritesheet.animations,scale:m}))),R=Array(8).fill(null).map(((e,i)=>new r.a({x:390*(i+1)+100,y:t.height-250+6,animations:t.spriteSheets.womenSpritesheet.animations,scale:m,viewLength:500})));let I=()=>{},C=()=>{},O=()=>{},W=()=>{},B=0,F=0;const q=new Array(50).fill(null).map((()=>(0,c.a)({maxSize:10,get:()=>({x:P.x,y:P.y+60,dx:2*(2-4*Math.random()),dy:1-1.5*Math.random()+.5,color:"red",width:m,height:m,ttl:[10,14,18][(0,a.j)(0,2)]})}))),H=new a.c({objects:[T,...X,...E,j,...L,z,...M,...k,...A,...Y,...R,P,...q.map((t=>t.pool.objects)).flat()],width:D,height:t.height}),$=(0,l.a)(50,H,{x:5,y:5},{x:t.width-5,y:115}),U=t=>new Promise((e=>setTimeout(e,t)));setTimeout((async()=>{const t=t=>{I=()=>(0,c.b)({x:g,y:80,fontSize:80,text:t})},e=["1","2","3","SEDUCE!"," "];for(let i=0;i<e.length;i++)t(e[i]),"SEDUCE!"===e[i]&&(S=!0,o.a.init(),o.a.on("Space",(()=>P.setWinking(!0))),o.a.on("ArrowRight",null,(()=>P.setMoveDirection(0))),o.a.on("ArrowLeft",null,(()=>P.setMoveDirection(0)))),await U(1e3)}),500);let V=null;function N(){return b>=Y.length}function G(){o.a.off("Space"),o.a.off("ArrowRight"),o.a.off("ArrowLeft"),P.setMoveDirection(0),[...Y,...R.filter((t=>t!==V))].forEach((t=>t.clearCycle())),V&&P.currentAnimation?.stop?.(),setTimeout((()=>{W=()=>(0,c.b)({text:"Press 'space' to restart",x:g,y:t.height-100,color:"grey",fontSize:16}),o.a.on("Space",(()=>{e(H,t.sceneSetupsList.game)}))}),1e3)}const J=new a.a({update(){const t=o.a.getMaxPriorityPressedButton(["ArrowRight","ArrowLeft"]);if(!N()&&!V&&t&&S&&P.setMoveDirection("ArrowLeft"===t?-1:1),P.isWinking()&&(R.forEach((t=>{t.checkIsPointInView(P.x)&&t.scaleX!==P.scaleX&&(t.activateAdrenaline(p),P.activateAdrenaline(p))})),Y.forEach((t=>{if(t.checkIsPointInView(P.x)&&t.scaleX!==P.scaleX){const e=t._loveLevel;t.increaseLoveLevel(),e<3&&3===t._loveLevel&&(b++,N()&&G())}})),P.setWinking(!1)),R.filter((t=>t.isAdrenalined())).forEach((t=>t.setTargetX(P.x))),P?.update(H),Y.forEach((t=>t.update())),R.forEach((t=>t.update())),R.forEach((t=>{t.isAdrenalined()&&t.x+t.width>=P.x-P.width&&t.x-t.width<=P.x+P.width&&!V&&(V=t,G())})),!N()&&V&&(V&&q.forEach((t=>t.update())),H.objects.filter((t=>t!==V&&t!==P)).forEach((t=>{t.opacity=(0,a.i)(t.opacity,0,.05),t.children.forEach((t=>t.opacity=0))})),k[0].opacity<.01&&V&&(B=(0,a.i)(B,1,.005),C=()=>(0,c.b)({x:g,y:v,fontSize:80,text:"You're dead",color:`rgba(255,255,255,${B})`}))),N()){P.setMoveDirection(-1);Y.filter((t=>1===t.opacity))?.length>0?Y.forEach((t=>{if(t.scaleX<.01)return void(t.opacity=0);t.children.forEach((t=>t.opacity=0));let e=parseFloat(1/Math.abs(Math.abs(t.x)-Math.abs(P.x)));e||(e=.01),e*=4,t.x=(0,a.i)(t.x,P.x,e),t.y=(0,a.i)(t.y,P.y+2*P.height,e),t.scaleX=(0,a.i)(t.scaleX,0,e/2),t.scaleY=(0,a.i)(t.scaleY,0,e/2)})):P.activateAdrenaline(),P.x<=200&&(H.objects.forEach((t=>{t.opacity=(0,a.i)(t.opacity,0,.05),t.children.forEach((t=>t.opacity=0))})),k[0].opacity<.01&&(F=(0,a.i)(F,1,.005),O=()=>(0,c.b)({x:g,y:v,fontSize:80,text:"All the boyars are seduced 😜",color:`rgba(255,255,255,${F})`})))}},render(){H.render(),(0,l.c)(H,{x:0,y:115},{x:t.width,y:115},10),[$].forEach((t=>t?.render())),W(),O(),C(),(0,c.b)({x:180,y:80,text:`BOYARS ATTRACTED: ${b}/${Y.length}`}),I()}});return H.beforeDestroy=()=>{J.stop(),$.destroy(),q.forEach((t=>t.destroy())),o.a.off("Space"),o.a.off("ArrowRight"),o.a.off("ArrowLeft"),[...Y,...R].forEach((t=>t.clearCycle())),H.remove([...H.objects])},{loop:J,scene:H}}s()}catch(x){s(x)}}))},282:(t,e,i)=>{i.r(e),i.d(e,{default:()=>o});var s=i(20),a=i(943),n=i(239),h=i(378),r=i(157);async function o(t,e){const i=()=>(0,n.b)({text:"Feast and courtesans",x:t.width/2,y:150,color:"white",fontSize:48}),o=()=>{[{text:"Well... Today I need to seduce as many boyars as possible",x:400},{text:"in order to extract gold from these moneybags.",x:360},{text:"I hope there will be no competitors at the feast...",x:370}].forEach(((e,i)=>(0,n.b)({text:e.text,x:e.x,y:t.height-300-20*i,color:"white",fontSize:18})))},c=()=>(0,n.b)({text:"Press 'arrows' to move left and right. Press 'space' to make an seductive wink",x:t.width/2,y:t.height-100,color:"grey",fontSize:16}),l=new h.a({x:300,y:t.height-250+6,animations:t.spriteSheets.playerSpritesheet.animations,scale:3,extraAnimations:{winking:t.spriteSheets.winkingSpritesheet.animations}}),d=new s.c({width:t.width,height:t.height}),p=(0,r.a)(100,d,{x:5,y:5},{x:t.width-5,y:t.height-400});a.a.init(),a.a.on("Space",(()=>l.setWinking(!0))),a.a.on("ArrowRight",null,(()=>l.setMoveDirection(0))),a.a.on("ArrowLeft",null,(()=>l.setMoveDirection(0)));const m=new s.a({update(){const i=a.a.getMaxPriorityPressedButton(["ArrowRight","ArrowLeft"]);i&&l.setMoveDirection("ArrowLeft"===i?-1:1),l.x>=t.width-200&&e(d,t.sceneSetupsList.game),l.update(d)},render(){(0,r.c)(d,{x:0,y:0},{x:t.width,y:0},t.height,"rgb(30,30,30)");const e=t.height-130;(0,r.c)(d,{x:0,y:e},{x:t.width,y:e}),(0,r.c)(d,{x:t.width-150,y:e-5},{x:t.width,y:e-5},10),(0,r.c)(d,{x:t.width-100,y:e-15},{x:t.width,y:e-15},10),(0,r.c)(d,{x:t.width-50,y:e-25},{x:t.width,y:e-25},10),(0,r.c)(d,{x:t.width-5,y:e-280},{x:t.width-5,y:e},10),p.render(),[i,o,c].forEach((t=>t())),l.render()}});return d.beforeDestroy=()=>{m.stop(),a.a.off("Space"),a.a.off("ArrowRight"),a.a.off("ArrowLeft"),p.destroy(),d.remove([l])},{loop:m,scene:d}}},95:(t,e,i)=>{i.a(t,(async(t,s)=>{try{i.d(e,{a:()=>l,b:()=>t});var a=i(20),n=i(157);const t=await new Promise((t=>{const e=new Image;e.onload=()=>{t(e)},e.src="./assets/main.png",console.log(e)})),h=await(0,n.b)(t,142,32,14,7),r=await(0,n.b)(t,480,0,20,40),o=await(0,n.b)(t,293,0,180,37),c=(t,e,i,s)=>new a.e({image:s,frameWidth:t,frameHeight:e,animations:i}),l={men1Spritesheet:c(32,40,{idle:{frames:0}},r),playerSpritesheet:c(30,38,{idle:{frames:[0,1],frameRate:.5},walk:{frames:[0,1],frameRate:2},run:{frames:[0,1,1],frameRate:8}},o),womenSpritesheet:c(30,38,{idle:{frames:[2,3],frameRate:.5},walk:{frames:[2,3],frameRate:2},run:{frames:[4,5],frameRate:8}},o),winkingSpritesheet:c(7,14,{wink:{frames:[0,1],frameRate:10,loop:!1}},h)};s()}catch(t){s(t)}}),1)},20:(t,e,i)=>{i.d(e,{a:()=>T,b:()=>D,c:()=>R,d:()=>E,e:()=>O,f:()=>L,g:()=>u,h:()=>w,i:()=>g,j:()=>_});let s=()=>{},a="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);";function n(t,e){let i=e.parentNode;if(t.setAttribute("data-kontra",""),i){let s=i.querySelector("[data-kontra]:last-of-type")||e;i.insertBefore(t,s.nextSibling)}else document.body.appendChild(t)}function h(t,e){let i=t.indexOf(e);if(-1!=i)return t.splice(i,1),!0}let r,o,c={};function l(t,e){c[t]=c[t]||[],c[t].push(e)}function d(t,e){c[t]=(c[t]||[]).filter((t=>t!=e))}function p(t,...e){(c[t]||[]).map((t=>t(...e)))}let m={get:(t,e)=>"_proxy"==e||s};function u(){return o}function w(t,{contextless:e=!1}={}){if(r=document.getElementById(t)||t||document.querySelector("canvas"),e&&(r=r||new Proxy({},m)),!r)throw Error("You must provide a canvas element for the game");return o=r.getContext("2d")||new Proxy({},m),o.imageSmoothingEnabled=!1,p("init"),{canvas:r,context:o}}class x{constructor({spriteSheet:t,frames:e,frameRate:i,loop:s=!0,name:a}){let{width:n,height:h,margin:r=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:e,frameRate:i,loop:s,name:a,width:n,height:h,margin:r,isStopped:!1,_f:0,_a:0})}clone(){return new x(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped)if(this.loop||this._f!=this.frames.length-1)for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate;else this.stop()}render({x:t,y:e,width:i=this.width,height:s=this.height,context:a=u()}){let n=this.frames[this._f]/this.spriteSheet._f|0,h=this.frames[this._f]%this.spriteSheet._f|0;a.drawImage(this.spriteSheet.image,h*this.width+(2*h+1)*this.margin,n*this.height+(2*n+1)*this.margin,this.width,this.height,t,e,i,s)}}function y(){return new x(...arguments)}function f(t,e){let i=Math.sin(e),s=Math.cos(e);return{x:t.x*s-t.y*i,y:t.x*i+t.y*s}}function _(t,e){return(Math.random()*(e-t+1)|0)+t}function g(t,e,i){return t*(1-i)+e*i}function v(t,e,i){return Math.min(Math.max(t,i),e)}function b(t,e){return[t,e]=[t,e].map((t=>S(t))),t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}function S(t){let{x:e=0,y:i=0,width:s,height:a}=t.world||t;return t.mapwidth&&(s=t.mapwidth,a=t.mapheight),t.anchor&&(e-=s*t.anchor.x,i-=a*t.anchor.y),s<0&&(e+=s,s*=-1),a<0&&(i+=a,a*=-1),{x:e,y:i,width:s,height:a}}class A{constructor(t=0,e=0,i={}){null!=t.x?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}set(t){this.x=t.x,this.y=t.y}add(t){return new A(this.x+t.x,this.y+t.y,this)}subtract(t){return new A(this.x-t.x,this.y-t.y,this)}scale(t){return new A(this.x*t,this.y*t)}normalize(t=this.length()||1){return new A(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?v(this._a,this._d,t):t}set y(t){this._y=this._c?v(this._b,this._e,t):t}}function k(){return new A(...arguments)}class M{constructor(t){return this.init(t)}init(t={}){this.position=k(),this.velocity=k(),this.acceleration=k(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class X extends M{init({width:t=0,height:e=0,context:i=u(),render:s=this.draw,update:a=this.advance,children:n=[],anchor:h={x:0,y:0},opacity:r=1,rotation:o=0,scaleX:c=1,scaleY:d=1,...p}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:h,opacity:r,rotation:o,scaleX:c,scaleY:d,...p}),this._di=!0,this._uw(),this.addChild(n),this._rf=s,this._uf=a,l("init",(()=>{this.context??=u()}))}update(t){this._uf(t),this.children.map((e=>e.update&&e.update(t)))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),1==this.scaleX&&1==this.scaleY||t.scale(this.scaleX,this.scaleY);let e=-this.width*this.anchor.x,i=-this.height*this.anchor.y;(e||i)&&t.translate(e,i),this.context.globalAlpha=this.opacity,this._rf(),(e||i)&&t.translate(-e,-i),this.children.map((t=>t.render&&t.render())),t.restore()}draw(){}_pc(){this._uw(),this.children.map((t=>t._pc()))}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wr:s=0,_wsx:a=1,_wsy:n=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=i*this.opacity,this._wsx=a*this.scaleX,this._wsy=n*this.scaleY,this._wx=this._wx*a,this._wy=this._wy*n,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=s+this.rotation;let{x:h,y:r}=f({x:this._wx,y:this._wy},s);this._wx=h,this._wy=r,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map((t=>{this.children.push(t),t.parent=this,t._pc=t._pc||s,t._pc()}))}removeChild(...t){t.flat().map((t=>{h(this.children,t)&&(t.parent=null,t._pc())}))}get opacity(){return this._opa}set opacity(t){this._opa=v(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class E extends X{init({image:t,width:e=(t?t.width:void 0),height:i=(t?t.height:void 0),...s}={}){super.init({image:t,width:e,height:i,...s})}get animations(){return this._a}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){this.currentAnimation?.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){super.advance(t),this.currentAnimation?.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function L(){return new E(...arguments)}new WeakMap;function j(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}function T({fps:t=60,clearCanvas:e=!0,update:i=s,render:a,context:n=u(),blur:h=!1}={}){if(!a)throw Error("You must provide a render() function");let r,o,c,d,m,w=0,x=1e3/t,y=1/t,f=e?j:s,_=!0;function g(){if(o=requestAnimationFrame(g),_&&(c=performance.now(),d=c-r,r=c,!(d>1e3))){for(p("tick"),w+=d;w>=x;)m.update(y),w-=x;f(m.context),m.render()}}return h||(window.addEventListener("focus",(()=>{_=!0})),window.addEventListener("blur",(()=>{_=!1}))),l("init",(()=>{m.context??=u()})),m={update:i,render:a,isStopped:!0,context:n,start(){r=performance.now(),this.isStopped=!1,requestAnimationFrame(g)},stop(){this.isStopped=!0,cancelAnimationFrame(o)},_frame:g,set _last(t){r=t}},m}class z{constructor({create:t,maxSize:e=1024}={}){let i;if(!t||!(i=t())||!(i.update&&i.init&&i.isAlive&&i.render))throw Error("Must provide create() function which returns an object with init(), update(), render(), and isAlive() functions");this._c=t,this.objects=[t()],this.size=0,this.maxSize=e}get(t={}){if(this.size==this.objects.length){if(this.size==this.maxSize)return;for(let t=0;t<this.size&&this.objects.length<this.maxSize;t++)this.objects.push(this._c())}let e=this.objects[this.size];return this.size++,e.init(t),e}getAliveObjects(){return this.objects.slice(0,this.size)}clear(){this.size=this.objects.length=0,this.objects.push(this._c())}update(t){let e,i=!1;for(let s=this.size;s--;)e=this.objects[s],e.update(t),e.isAlive()||(i=!0,this.size--);i&&this.objects.sort(((t,e)=>e.isAlive()-t.isAlive()))}render(){for(let t=this.size;t--;)this.objects[t].render()}}function D(){return new z(...arguments)}function P(t){let e=[];return t._dn?e.push(t._dn):t.children&&t.children.map((t=>{e=e.concat(P(t))})),e}class Y{constructor({id:t,name:e=t,objects:i=[],context:s=u(),cullObjects:h=!0,cullFunction:r=b,sortFunction:o,...c}){this._o=[],Object.assign(this,{id:t,name:e,context:s,cullObjects:h,cullFunction:r,sortFunction:o,...c});let d=this._dn=document.createElement("section");d.tabIndex=-1,d.style=a,d.id=t,d.setAttribute("aria-label",e);let p=this;this.camera=new class extends X{set x(t){p.sx=t-this.centerX,super.x=t}get x(){return super.x}set y(t){p.sy=t-this.centerY,super.y=t}get y(){return super.y}}({context:s,anchor:{x:.5,y:.5},render:this._rf.bind(this)}),this.add(i),this._i=()=>{this.context??=u();let t=this.context.canvas,{width:e,height:i}=t,s=e/2,a=i/2;Object.assign(this.camera,{centerX:s,centerY:a,x:s,y:a,width:e,height:i}),this._dn.isConnected||n(this._dn,t)},this.context&&this._i(),l("init",this._i)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map((t=>{this._o.push(t),t.parent=this,P(t).map((t=>{this._dn.appendChild(t)}))}))}remove(...t){t.flat().map((t=>{h(this._o,t),t.parent=null,P(t).map((t=>{n(t,this.context)}))}))}show(){this.hidden=this._dn.hidden=!1;let t=this._o.find((t=>t.focus));t?t.focus():this._dn.focus(),this.onShow()}hide(){this.hidden=this._dn.hidden=!0,this.onHide()}destroy(){d("init",this._i),this._dn.remove(),this._o.map((t=>t.destroy&&t.destroy()))}lookAt(t){let{x:e,y:i}=t.world||t;this.camera.x=e,this.camera.y=i}update(t){this.hidden||this._o.map((e=>e.update&&e.update(t)))}_rf(){let{_o:t,context:e,_sx:i,_sy:s,camera:a,sortFunction:n,cullObjects:h,cullFunction:r}=this;e.translate(i,s);let o=t;h&&(o=o.filter((t=>r(a,t)))),n&&o.sort(n),o.map((t=>t.render&&t.render()))}render(){if(!this.hidden){let{context:t,camera:e}=this,{x:i,y:s,centerX:a,centerY:n}=e;t.save(),this._sx=a-i,this._sy=n-s,t.translate(this._sx,this._sy),e.render(),t.restore()}}onShow(){}onHide(){}}function R(){return new Y(...arguments)}function I(t){if(+t==t)return t;let e=[],i=t.split(".."),s=+i[0],a=+i[1],n=s;if(s<a)for(;n<=a;n++)e.push(n);else for(;n>=a;n--)e.push(n);return e}class C{constructor({image:t,frameWidth:e,frameHeight:i,frameMargin:s,animations:a}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:e,height:i,margin:s},this._f=t.width/e|0,this.createAnimations(a)}createAnimations(t){let e,i;for(i in t){let{frames:s,frameRate:a,loop:n}=t[i];if(e=[],null==s)throw Error("Animation "+i+" must provide a frames property");[].concat(s).map((t=>{e=e.concat(I(t))})),this.animations[i]=y({spriteSheet:this,frames:e,frameRate:a,loop:n,name:i})}}}function O(){return new C(...arguments)}}},n={};function h(t){var e=n[t];if(void 0!==e)return e.exports;var i=n[t]={exports:{}};return a[t](i,i.exports,h),i.exports}t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",i="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",s=t=>{t&&t.d<1&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},h.a=(a,n,h)=>{var r;h&&((r=[]).d=-1);var o,c,l,d=new Set,p=a.exports,m=new Promise(((t,e)=>{l=e,c=t}));m[e]=p,m[t]=t=>(r&&t(r),d.forEach(t),m.catch((()=>{}))),a.exports=m,n((a=>{var n;o=(a=>a.map((a=>{if(null!==a&&"object"==typeof a){if(a[t])return a;if(a.then){var n=[];n.d=0,a.then((t=>{h[e]=t,s(n)}),(t=>{h[i]=t,s(n)}));var h={};return h[t]=t=>t(n),h}}var r={};return r[t]=()=>{},r[e]=a,r})))(a);var h=()=>o.map((t=>{if(t[i])throw t[i];return t[e]})),c=new Promise((e=>{(n=()=>e(h)).r=0;var i=t=>t!==r&&!d.has(t)&&(d.add(t),t&&!t.d&&(n.r++,t.push(n)));o.map((e=>e[t](i)))}));return n.r?c:h()}),(t=>(t?l(m[i]=t):c(p),s(r)))),r&&r.d<0&&(r.d=0)},h.d=(t,e)=>{for(var i in e)h.o(e,i)&&!h.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},h.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),h.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};h(138)})();